---

- name: "2.2.1 | PATCH | Ensure Access Credential Manager as a trusted caller is set to No One"
  when: win19cis_rule_2_2_1
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.1
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeTrustedCredManAccessPrivilege
    users: []
    action: set

- name: "2.2.2 | PATCH | Ensure Access this computer from the network is set to Administrators, Authenticated Users, & ENTERPRISE DOMAIN CONTROLLERS DC only | Domain Controller"
  when:
    - win19cis_rule_2_2_2
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.2.2
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeNetworkLogonRight
    users:
      - Administrators
      - Authenticated Users
      - ENTERPRISE DOMAIN CONTROLLERS
    action: set

- name: "2.2.3 | PATCH | Ensure Access this computer from the network is set to Administrators, Authenticated Users, & ENTERPRISE DOMAIN CONTROLLERS MS only | Member Server"
  when:
    - win19cis_rule_2_2_3
    - prelim_win19cis_is_domain_member
  tags:
    - level1-memberserver
    - rule_2.2.3
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeNetworkLogonRight
    users:
      - Administrators
      - Authenticated Users
    action: set

- name: "2.2.4 | PATCH | Ensure Act as part of the operating system is set to No One"
  when: win19cis_rule_2_2_4
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.4
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeTcbPrivilege
    users: []
    action: set

- name: "2.2.5 | PATCH | Ensure Add workstations to domain is set to Administrators DC only | Domain Controller"
  when:
    - win19cis_rule_2_2_5
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.2.5
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeMachineAccountPrivilege
    users: Administrators
    action: set

- name: "2.2.6 | PATCH | Ensure Adjust memory quotas for a process is set to Administrators LOCAL SERVICE NETWORK SERVICE"
  when: win19cis_rule_2_2_6
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.6
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeIncreaseQuotaPrivilege
    users:
      - Administrators
      - LOCAL SERVICE
      - NETWORK SERVICE
    action: set

- name: "2.2.7 | PATCH |  Ensure Allow log on locally is set to Administrators, ENTERPRISE DOMAIN CONTROLLERS (DC only)"
  when:
    - win19cis_rule_2_2_7
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.2.7
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeInteractiveLogonRight
    users:
      - Administrators
      - ENTERPRISE DOMAIN CONTROLLERS
    action: set

- name: "2.2.8 | PATCH |  Ensure Allow log on locally is set to Administrators (MS only)"
  when:
    - win19cis_rule_2_2_8
    - prelim_win19cis_is_domain_member
  tags:
    - level1-memberserver
    - rule_2.2.8
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeInteractiveLogonRight
    users:
      - Administrators
    action: set

- name: "2.2.9 | PATCH | Ensure 'Allow log on through Remote Desktop Services' is set to 'Administrators' (DC only)"
  when:
    - win19cis_rule_2_2_9
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.2.9
    - patch
    - userrights
    - remotedesktop
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeRemoteInteractiveLogonRight
    users:
      - Administrators
    action: set

- name: "2.2.10 | PATCH | Ensure 'Allow log on through Remote Desktop Services' is set to 'Administrators, Remote Desktop Users' (MS Only)"
  when:
    - win19cis_rule_2_2_10
    - prelim_win19cis_is_domain_member
  tags:
    - level1-memberserver
    - rule_2.2.10
    - patch
    - userrights
    - remotedesktop
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeRemoteInteractiveLogonRight
    users:
      - Administrators
      - Remote Desktop Users
    action: set

- name: "2.2.11 | PATCH | Ensure Back up files and directories is set to Administrators"
  when:
    - win19cis_rule_2_2_11
    - prelim_win19cis_is_domain_member
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.11
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeBackupPrivilege
    users:
      - Administrators
    action: set

- name: "2.2.12 | PATCH | Ensure Change the system time is set to Administrators LOCAL SERVICE"
  when: win19cis_rule_2_2_12
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.12
    - patch
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeSystemTimePrivilege
    users:
      - Administrators
      - LOCAL SERVICE
    action: set

- name: "2.2.13 | PATCH | Ensure Change the time zone is set to Administrators LOCAL SERVICE"
  when: win19cis_rule_2_2_13
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.13
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeTimeZonePrivilege
    users:
      - Administrators
      - LOCAL SERVICE
    action: set

- name: "2.2.14 | PATCH | Ensure Create a pagefile is set to Administrators"
  when: win19cis_rule_2_2_14
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.14
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeCreatePagefilePrivilege
    users:
      - Administrators
    action: set

- name: "2.2.15 | PATCH | Ensure Create a token object is set to No One"
  when: win19cis_rule_2_2_15
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.15
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeCreateTokenPrivilege
    users: []
    action: set

- name: "2.2.16 | PATCH | Ensure Create global objects is set to Administrators LOCAL SERVICE NETWORK SERVICE SERVICE"
  when: win19cis_rule_2_2_16
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.16
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeCreateGlobalPrivilege
    users:
      - Administrators
      - LOCAL SERVICE
      - NETWORK SERVICE
      - SERVICE
    action: set

- name: "2.2.17 | PATCH | Ensure Create permanent shared objects is set to No One"
  when: win19cis_rule_2_2_17
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.17
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeCreatePermanentPrivilege
    users: []
    action: set

- name: "2.2.18 | PATCH | Ensure Create symbolic links is set to Administrators DC only | Domain Controller"
  when:
    - win19cis_rule_2_2_18
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.2.18
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeCreateSymbolicLinkPrivilege
    users:
      - Administrators
    action: set

- name: "2.2.19 | PATCH | Ensure Create symbolic links is set to Administrators NT VIRTUAL MACHINE-Virtual Machines MS only | Member Server"
  when:
    - win19cis_rule_2_2_19
    - prelim_win19cis_is_domain_member
  tags:
    - level1-memberserver
    - rule_2.2.19
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  block:
    - name: "2.2.19 | PATCH | Ensure Create symbolic links is set to Administrators NT VIRTUAL MACHINE-Virtual Machines  |  Without Hyper-v | Member Server"
      when: not win19cis_hyperv_installed
      ansible.windows.win_user_right:
        name: SeCreateSymbolicLinkPrivilege
        users:
          - Administrators
        action: set

    - name: "2.2.19 | PATCH | Ensure Create symbolic links is set to Administrators NT VIRTUAL MACHINE-Virtual Machines MS only | With Hyper-v | Member Server"
      when: win19cis_hyperv_installed
      ansible.windows.win_user_right:
        name: SeCreateSymbolicLinkPrivilege
        users:
          - Administrators
          - NT VIRTUAL MACHINE\Virtual Machines
        action: set

- name: "2.2.20 | PATCH | Ensure Debug programs is set to Administrators"
  when: win19cis_rule_2_2_20
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.20
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeDebugPrivilege
    users:
      - Administrators
    action: set

- name: "2.2.21 | PATCH | Ensure Deny access to this computer from the network to include Guests DC only | Domain Controller"
  when:
    - win19cis_rule_2_2_21
    - prelim_win19cis_is_domain_controller
    - not win_skip_for_test
  tags:
    - level1-domaincontroller
    - rule_2.2.21
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeDenyNetworkLogonRight
    users:
      - Guests
    action: add

- name: "2.2.22 | PATCH | Ensure Deny access to this computer from the network to include Guests Local account and member of Administrators group MS only | Member Server"
  when:
    - win19cis_rule_2_2_22
    - prelim_win19cis_is_domain_member
  tags:
    - level1-memberserver
    - rule_2.2.22
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeDenyNetworkLogonRight
    users:
      - Guests
      - Local Account
      - Administrators
    action: add

- name: "2.2.23 | PATCH | Ensure Deny log on as a batch job to include Guests"
  when: win19cis_rule_2_2_23
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.23
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeDenyBatchLogonRight
    users:
      - Guests
    action: add

- name: "2.2.24 | PATCH | Ensure Deny log on as a service to include Guests"
  when: win19cis_rule_2_2_24
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.24
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeDenyServiceLogonRight
    users:
      - Guests
    action: add

- name: "2.2.25 | PATCH | Ensure Deny log on locally to include Guests"
  when: win19cis_rule_2_2_25
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.25
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeDenyInteractiveLogonRight
    users:
      - Guests
    action: add

- name: "2.2.26 | PATCH | Ensure Deny log on through Remote Desktop Services to include Guests DC only | Domain Controller"
  when:
    - win19cis_rule_2_2_26
    - prelim_win19cis_is_domain_controller
    - not win_skip_for_test
  tags:
    - level1-domaincontroller
    - rule_2.2.26
    - patch
    - guest
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeDenyRemoteInteractiveLogonRight
    users:
      - Guests
    action: add

- name: "2.2.27 | PATCH | Ensure Deny log on through Remote Desktop Services is set to Guests Local account MS only | Member Server"
  when:
    - win19cis_rule_2_2_27
    - prelim_win19cis_is_domain_member
    - not win_skip_for_test
  tags:
    - level1-memberserver
    - rule_2.2.27
    - patch
    - guest
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeDenyRemoteInteractiveLogonRight
    users:
      - Guests
      - Local Account
    action: set

- name: "2.2.28 | PATCH | Ensure Enable computer and user accounts to be trusted for delegation is set to Administrators DC only | Domain Controller"
  when:
    - win19cis_rule_2_2_28
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.2.28
    - patch
    - userrights
    - administrators
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeEnableDelegationPrivilege
    users: Administrators
    action: set

- name: "2.2.29 | PATCH | Ensure Enable computer and user accounts to be trusted for delegation is set to No One MS only | Member Server"
  when:
    - win19cis_rule_2_2_29
    - prelim_win19cis_is_domain_member
  tags:
    - level1-memberserver
    - rule_2.2.29
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeEnableDelegationPrivilege
    users: []
    action: set

- name: "2.2.30 | PATCH | Ensure Force shutdown from a remote system is set to Administrators"
  when: win19cis_rule_2_2_30
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.30
    - patch
    - userrights
    - administrators
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeRemoteShutdownPrivilege
    users:
      - Administrators
    action: set

- name: "2.2.31 | PATCH | Ensure Generate security audits is set to LOCAL SERVICE, NETWORK SERVICE"
  when: win19cis_rule_2_2_31
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.31
    - patch
    - userrights
    - services
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeAuditPrivilege
    users:
      - LOCAL SERVICE
      - NETWORK SERVICE
    action: set

- name: "2.2.32 | PATCH | Ensure Impersonate a client after authentication is set to Administrators LOCAL SERVICE NETWORK SERVICE SERVICE DC only | Domain Controller"
  when:
    - win19cis_rule_2_2_32
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.2.32
    - patch
    - userrights
    - services
    - administrators
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeImpersonatePrivilege
    users:
      - Administrators
      - LOCAL SERVICE
      - NETWORK SERVICE
      - SERVICE
    action: set

- name: "2.2.33 | PATCH | Ensure Impersonate a client after authentication is set to Administrators LOCAL SERVICE, NETWORK SERVICE, SERVICE and when the Web Server IIS Role with Web Services Role Service is installed IIS IUSRS MS only"
  when:
    - win19cis_rule_2_2_33
    - prelim_win19cis_is_domain_member
  tags:
    - level1-memberserver
    - rule_2.2.33
    - patch
    - userrights
    - administrators
    - services
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  block:
    - name: "2.2.33 | PATCH | Ensure Impersonate a client after authentication is set to Administrators LOCAL SERVICE, NETWORK SERVICE, SERVICE and when the Web Server IIS Role with Web Services Role Service is installed IIS IUSRS MS only"
      when: not win19cis_iis_and_web_services_installed
      ansible.windows.win_user_right:
        name: SeImpersonatePrivilege
        users:
          - Administrators
          - LOCAL SERVICE
          - NETWORK SERVICE
          - SERVICE
        action: set

    - name: "2.2.33 | PATCH | Ensure Impersonate a client after authentication is set to Administrators LOCAL SERVICE, NETWORK SERVICE, SERVICE and when the Web Server IIS Role with Web Services Role Service is installed IIS IUSRS MS only"
      when: win19cis_iis_and_web_services_installed
      ansible.windows.win_user_right:
        name: SeImpersonatePrivilege
        users:
          - Administrators
          - IIS_IUSRS
          - LOCAL SERVICE
          - NETWORK SERVICE
          - SERVICE
        action: set

- name: "2.2.34 | PATCH | Ensure Increase scheduling priority is set to Administrators Window ManagerWindow Manager Group"
  when: win19cis_rule_2_2_34
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.34
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeIncreaseBasePriorityPrivilege
    users: "{{ win19cis_increase_scheduling_priority_users }}"
    action: set

- name: "2.2.35 | PATCH | Ensure Load and unload device drivers is set to Administrators"
  when: win19cis_rule_2_2_35
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.35
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeLoadDriverPrivilege
    users:
      - Administrators
    action: set

- name: "2.2.36 | PATCH | Ensure Lock pages in memory is set to No One"
  when: win19cis_rule_2_2_36
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.36
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeLockMemoryPrivilege
    users: []
    action: set

- name: "2.2.37 | PATCH | Ensure Log on as a batch job is set to Administrators DC Only | Domain Controller"
  when:
    - win19cis_rule_2_2_37
    - prelim_win19cis_is_domain_controller
  tags:
    - level2-domaincontroller
    - rule_2.2.37
    - patch
    - userrights
    - administrators
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeBatchLogonRight
    users: Administrators
    action: set

- name: "2.2.38 | PATCH | Ensure Manage auditing and security log is set to Administrators and when Exchange is running in the environment Exchange Servers DC only | Domain Controller"
  when:
    - win19cis_rule_2_2_38
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.2.38
    - patch
    - userrights
    - administrators
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  block:
    - name: "2.2.38 | PATCH | Ensure Manage auditing and security log is set to Administrators and when Exchange is running in the environment Exchange Servers DC only | Set Non-Exchange Server Groups | Domain Controller"
      when: not win19cis_exchange_server_running
      ansible.windows.win_user_right:
        name: SeSecurityPrivilege
        users:
          - Administrators
        action: set

    - name: "2.2.38 | PATCH | Ensure Manage auditing and security log is set to Administrators and when Exchange is running in the environment Exchange Servers DC only | Set Exchange Server Groups | Domain Controller"
      when: win19cis_exchange_server_running
      ansible.windows.win_user_right:
        name: SeSecurityPrivilege
        users:
          - Administrators
          - Exchange Servers
        action: set

- name: "2.2.39 | PATCH | Ensure 'Manage auditing and security log' is set to 'Administrators' (MS only) | Member Server"
  when:
    - win19cis_rule_2_2_39
    - prelim_win19cis_is_domain_member
  tags:
    - level1-memberserver
    - rule_2.2.39
    - patch
    - userrights
    - administrators
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeSecurityPrivilege
    users:
      - Administrators
    action: set

- name: "2.2.40 | PATCH | Ensure Modify an object label is set to No One"
  when: win19cis_rule_2_2_40
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.40
    - patch
    - userrights
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeReLabelPrivilege
    users: []
    action: set

- name: "2.2.41 | PATCH | Ensure Modify firmware environment values is set to Administrators"
  when: win19cis_rule_2_2_41
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.41
    - patch
    - userrights
    - administrators
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeSystemEnvironmentPrivilege
    users:
      - Administrators
    action: set

- name: "2.2.42 | PATCH | Ensure Perform volume maintenance tasks is set to Administrators"
  when: win19cis_rule_2_2_42
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.42
    - patch
    - userrights
    - administrators
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeManageVolumePrivilege
    users:
      - Administrators
    action: set

- name: "2.2.43 | PATCH | Ensure Profile single process is set to Administrators"
  when: win19cis_rule_2_2_43
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.43
    - patch
    - userrights
    - administrators
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeProfileSingleProcessPrivilege
    users:
      - Administrators
    action: set

- name: "2.2.44 | PATCH | Ensure Profile system performance is set to Administrators NT SERVICE.WdiServiceHost"
  when: win19cis_rule_2_2_44
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.44
    - patch
    - userrights
    - administrator
    - service
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeSystemProfilePrivilege
    users:
      - Administrators
      - NT SERVICE\WdiServiceHost
    action: set

- name: "2.2.45 | PATCH | Ensure Replace a process level token is set to LOCAL SERVICE NETWORK SERVICE"
  when: win19cis_rule_2_2_45
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.45
    - patch
    - userrights
    - service
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeAssignPrimaryTokenPrivilege
    users:
      - LOCAL SERVICE
      - NETWORK SERVICE
    action: set

- name: "2.2.46 | PATCH | Ensure Restore files and directories is set to Administrators"
  when: win19cis_rule_2_2_46
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.46
    - patch
    - userright
    - administrator
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeRestorePrivilege
    users:
      - Administrators
    action: set

- name: "2.2.47 | PATCH | Ensure Shut down the system is set to Administrators"
  when: win19cis_rule_2_2_47
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.47
    - patch
    - userright
    - administrator
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeShutdownPrivilege
    users:
      - Administrators
    action: set

- name: "2.2.48 | PATCH | Ensure Synchronize directory service data is set to No One DC only | Domain Controller"
  when:
    - win19cis_rule_2_2_48
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.2.48
    - patch
    - userright
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeSyncAgentPrivilege
    users: []
    action: set

- name: "2.2.49 | PATCH | Ensure Take ownership of files or other objects is set to Administrators"
  when: win19cis_rule_2_2_49
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.2.49
    - patch
    - userright
    - administrator
    - NIST800-171_3.1.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AU-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AU-9_4
  ansible.windows.win_user_right:
    name: SeTakeOwnershipPrivilege
    users:
      - Administrators
    action: set

- name: "2.3.1.1 | PATCH | Ensure Accounts Block Microsoft accounts is set to Users can not add or log on with Microsoft accounts"
  when: win19cis_rule_2_3_1_1
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.1.1
    - patch
    - securitypolicy
    - NIST800-171_3.1.1
    - NIST800-53_AC-2_1
    - NIST800-53R5_AC-2_1
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows\Currentversion\Policies\System
    name: NoConnectedUser
    data: 3
    type: dword

- name: "2.3.1.2 | PATCH | Ensure Accounts Guest account status is set to Disabled MS only | Member Server"
  when:
    - win19cis_rule_2_3_1_2
    - prelim_win19cis_is_domain_member
  tags:
    - level1-memberserver
    - rule_2.3.1.2
    - patch
    - securitypolicy
    - NIST800-171_3.5.2
    - NIST800-53_IA-5
    - NIST800-53R55_IA-5
  community.windows.win_security_policy:
    section: System Access
    key: EnableGuestAccount
    value: 0

- name: "2.3.1.3 | PATCH | Ensure Accounts Limit local account use of blank passwords to console logon only is set to Enabled"
  when: win19cis_rule_2_3_1_3
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.1.3
    - patch
    - account
    - NIST800-171_3.5.2
    - NIST800-53_IA-5_1
    - NIST800-53R5_IA-5_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Lsa
    name: LimitBlankPasswordUse
    data: 1
    type: dword

- name: "2.3.1.4 | PATCH | Configure Accounts Rename administrator account"
  when:
    - win19cis_rule_2_3_1_4
    - not win_skip_for_test
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.1.4
    - patch
    - securitypolicy
    - NIST800-171_3.5.2
    - NIST800-53_IA-5
    - NIST800-53R5_IA-5
  block:
    - name: "2.3.1.4 | PATCH | Configure Accounts Rename administrator account. | Make Changes To Admin Name."
      when: "'adminchangethis' not in win19cis_admin_username"
      community.windows.win_security_policy:
        section: System Access
        key: newadministratorname
        value: "{{ win19cis_admin_username }}"

    - name: "2.3.1.4 | AUDIT | Configure Accounts Rename administrator account. | Warning Msg For Default Variable Not Edited."
      when: "'adminchangethis' in win19cis_admin_username"
      ansible.builtin.debug:
        msg:
          - "Warning!! You have not changed the default admin username in win19cis_admin_username please"
          - "make the necessary change to the variable to be in compliance."

    - name: "2.3.1.4 | AUDIT | Configure Accounts Rename administrator account. | Add Warn Count."
      vars:
        warn_control_id: '2.3.1.4'
      when: "'adminchangethis' in win19cis_admin_username"
      ansible.builtin.import_tasks:
        file: warning_facts.yml

- name: "2.3.1.5 | PATCH | Configure Accounts Rename guest account"
  when: win19cis_rule_2_3_1_5
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.1.5
    - patch
    - securitypolicy
    - NIST800-171_3.5.2
    - NIST800-53_IA-5
    - NIST800-53R5_IA-5
  block:
    - name: "2.3.1.5 | PATCH | Configure Accounts Rename guest account. | Make Changes To Guest Name."
      when: "'guestchangethis' not in win19cis_guest_username"
      community.windows.win_security_policy:
        section: System Access
        key: NewGuestName
        value: "{{ win19cis_guest_username }}"

    - name: "2.3.1.5 | AUDIT | Configure Accounts Rename guest account. | Warning Msg For Default Variable Not Edited."
      when: "'guestchangethis' in win19cis_guest_username"
      ansible.builtin.debug:
        msg:
          - "Warning!! You have not changed the default guest name in win19cis_guest_username please"
          - "make the necessary change to the variable to be in compliance."

    - name: "2.3.1.5 | AUDIT | Configure Accounts Rename guest account. | Add Warn Count."
      vars:
        warn_control_id: '2.3.1.5'
      when: "'guestchangethis' in win19cis_guest_username"
      ansible.builtin.import_tasks:
        file: warning_facts.yml

- name: "2.3.2.1 | PATCH | Ensure Audit Force audit policy subcategory settings Windows Vista or later to override audit policy category settings is set to Enabled"
  when: win19cis_rule_2_3_2_1
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.2.1
    - patch
    - auditpolicy
    - NIST800-171_3.3.1
    - NIST800-171_3.3.2
    - NIST800-171_3.3.6
    - NIST800-53_AU-3
    - NIST800-53_AU-3_1
    - NIST800-53_AU-7
    - NIST800-53_AU-12
    - NIST800-53R5_AU-3
    - NIST800-53R5_AU-3_1
    - NIST800-53R5_AU-7
    - NIST800-53R5_AU-12
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
    name: SCENoApplyLegacyAuditPolicy
    data: 1
    type: dword

- name: "2.3.2.2 | PATCH | Ensure Audit Shut down system immediately if unable to log security audits is set to Disabled"
  when: win19cis_rule_2_3_2_2
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.2.2
    - patch
    - auditpolicy
    - NIST800-53_AU-4
    - NIST800-53R5_AU-4
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
    name: CrashOnAuditFail
    data: 0
    type: dword

- name: "2.3.4.1 | PATCH | Ensure Devices Prevent users from installing printer drivers is set to Enabled"
  when: win19cis_rule_2_3_4_1
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.4.1
    - patch
    - devices
    - NIST800-171_3.3.1
    - NIST800-171_3.1.5
    - NIST800-171_3.3.8
    - NIST800-171_3.3.9
    - NIST800-53_AC-2
    - NIST800-53_AC-3
    - NIST800-53_AC-6
    - NIST800-53_AC-6_1
    - NIST800-53_AC-6_7
    - NIST800-53_AC-9_4
    - NIST800-53R5_AC-2
    - NIST800-53R5_AC-3
    - NIST800-53R5_AC-6
    - NIST800-53R5_AC-6_1
    - NIST800-53R5_AC-6_7
    - NIST800-53R5_AC-9_4
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Print\Providers\Lanman Print Services\Servers
    name: AddPrinterDrivers
    data: 1
    type: dword

- name: "2.3.5.1 | PATCH | Ensure Domain controller Allow server operators to schedule tasks is set to Disabled DC only | Domain Controller"
  when:
    - win19cis_rule_2_3_5_1
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.3.5.1
    - patch
    - scheduledtasks
    - NIST800-171_3.1.5
    - NIST800-53_AC-6_8
    - NIST800-53R5_AC-6_8
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
    name: SubmitControl
    data: 0
    type: dword

# Per CIS Note: If this policy is set as prescribed, the registry key vulnerablechannelallowlist will not be present in the above registry location.
- name: "2.3.5.2 | PATCH | Ensure Domain controller Allow vulnerable Netlogon secure channel connections is set to Not Configured DC only | Domain Controller"
  when:
    - win19cis_rule_2_3_5_2
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.3.5.2
    - patch
    - logon
    - NIST800-171_3.4.2
    - NIST800-53_CM-6b
    - NIST800-53R5_CM-6b
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters
    name: VulnerableChannelAllowList
    data: 0
    type: dword

- name: "2.3.5.3 | PATCH | Ensure Domain controller LDAP server channel binding token requirements is set to Always DC only | Domain Controller"
  when:
    - win19cis_rule_2_3_5_3
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.3.5.3
    - patch
    - ldap
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_IA-5
    - NIST800-53_IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_IA-5
    - NIST800-53R5_IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\CurrentControlSet\Services\NTDS\Parameters
    name: LdapEnforceChannelBinding
    data: 2
    type: dword

- name: "2.3.5.4 | PATCH | Ensure Domain controller LDAP server signing requirements is set to Require signing DC only | Domain Controller"
  when:
    - win19cis_rule_2_3_5_4
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.3.5.4
    - patch
    - ldap
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_IA-5
    - NIST800-53_IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_IA-5
    - NIST800-53R5_IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\CurrentControlSet\Services\NTDS\Parameters
    name: LDAPServerIntegrity
    data: 2
    type: dword

- name: "2.3.5.5 | PATCH | Ensure Domain controller Refuse machine account password changes is set to Disabled DC only | Domain Controller"
  when:
    - win19cis_rule_2_3_5_5
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.3.5.5
    - patch
    - account
    - NIST800-171_3.4.1
    - NIST800-171_3.4.2
    - NIST800-171_3.4.6
    - NIST800-171_3.4.7
    - NIST800-171_3.13.1
    - NIST800-171_3.13.2
    - NIST800-53_CM-1
    - NIST800-53_CM-2
    - NIST800-53_AC-2
    - NIST800-53_CM-6
    - NIST800-53_CM-7
    - NIST800-53_CM-7_1
    - NIST800-53_CM-9
    - NIST800-53_SA-3
    - NIST800-53_SA-8
    - NIST800-53_SA-10
    - NIST800-53R5_CM-1
    - NIST800-53R5_CM-2
    - NIST800-53R5_AC-2
    - NIST800-53R5_CM-6
    - NIST800-53R5_CM-7
    - NIST800-53R5_CM-7_1
    - NIST800-53R5_CM-9
    - NIST800-53R5_SA-3
    - NIST800-53R5_SA-8
    - NIST800-53R5_SA-10
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters
    name: RefusePasswordChange
    data: 0
    type: dword

- name: "2.3.6.1 | PATCH | Ensure Domain member Digitally encrypt or sign secure channel data always is set to Enabled"
  when:
    - win19cis_rule_2_3_6_1
    - not ansible_windows_domain_role == "Primary domain controller"
    - not prelim_win19cis_is_standalone
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - level1-domainmember
    - rule_2.3.6.1
    - patch
    - encryption
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_IA-5
    - NIST800-53_IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_IA-5
    - NIST800-53R5_IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Services\Netlogon\Parameters
    name: RequireSignOrSeal
    data: 1
    type: dword

- name: "2.3.6.2 | PATCH | Ensure Domain member Digitally encrypt secure channel data when possible is set to Enabled"
  when:
    - win19cis_rule_2_3_6_2
    - not ansible_windows_domain_role == "Primary domain controller"
    - not prelim_win19cis_is_standalone
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - level1-domainmember
    - rule_2.3.6.2
    - patch
    - encryption
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_IA-5
    - NIST800-53_IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_IA-5
    - NIST800-53R5_IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Services\Netlogon\Parameters
    name: SealSecureChannel
    data: 1
    type: dword

- name: "2.3.6.3 | PATCH | Ensure Domain member Digitally sign secure channel data when possible is set to Enabled"
  when:
    - win19cis_rule_2_3_6_3
    - not ansible_windows_domain_role == "Primary domain controller"
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - level1-domainmember
    - rule_2.3.6.3
    - patch
    - logon
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_IA-5
    - NIST800-53_IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_IA-5
    - NIST800-53R5_IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Services\Netlogon\Parameters
    name: SignSecureChannel
    data: 1
    type: dword

- name: "2.3.6.4 | PATCH | Ensure Domain member Disable machine account password changes is set to Disabled"
  when:
    - win19cis_rule_2_3_6_4
    - not ansible_windows_domain_role == "Primary domain controller"
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - level1-domainmember
    - rule_2.3.6.4
    - patch
    - logon
    - NIST800-171_3.1.1
    - NIST800-53_AC-2_1
    - NIST800-53R5_AC-2_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Services\Netlogon\Parameters
    name: DisablePasswordChange
    data: 0
    type: dword

- name: "2.3.6.5 | PATCH | Ensure Domain member Maximum machine account password age is set to 30 or fewer days but not 0"
  when:
    - win19cis_rule_2_3_6_5
    - not ansible_windows_domain_role == "Primary domain controller"
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - level1-domainmember
    - rule_2.3.6.5
    - patch
    - account
    - NIST800-171_3.5.2
    - NIST800-53_IA-5_1
    - NIST800-53R5_IA-5_1
  block:
    - name: "2.3.6.5 | PATCH | Ensure Domain member Maximum machine account password age is set to 30 or fewer days but not 0. | Apply Settings To Registry."
      community.windows.win_security_policy:
        section: System Access
        key: MaximumPasswordAge
        value: "{{ win19cis_domain_member_maximum_password_age }}"
      when:
        - win19cis_domain_member_maximum_password_age <= 30
        - win19cis_domain_member_maximum_password_age > 0

    - name: "2.3.6.5 | AUDIT | Ensure Domain member Maximum machine account password age is set to 30 or fewer days but not 0. | Warning Check For Variable Standards."
      ansible.builtin.debug:
        msg:
          - "Warning!! You have an invalid number of days set for win19cis_domain_member_maximum_password_age please read"
          - "the notes for the variable and make the necessary change to the variable to be in compliance."
      when:
        - win19cis_domain_member_maximum_password_age > 30 or
          win19cis_domain_member_maximum_password_age == 0

    - name: "2.3.6.5 | AUDIT | Ensure Domain member Maximum machine account password age is set to 30 or fewer days but not 0. | Warn Count."
      ansible.builtin.import_tasks: warning_facts.yml
      vars:
        warn_control_id: '2.3.6.5'
      when:
        - win19cis_domain_member_maximum_password_age > 30 or
          win19cis_domain_member_maximum_password_age == 0

- name: "2.3.6.6 | PATCH | Ensure Domain member Require strong Windows 2000 or later session key is set to Enabled"
  when:
    - win19cis_rule_2_3_6_6
    - not ansible_windows_domain_role == "Primary domain controller"
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - level1-domainmember
    - rule_2.3.6.6
    - patch
    - logon
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_IA-5
    - NIST800-53_IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_IA-5
    - NIST800-53R5_IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Services\Netlogon\Parameters
    name: RequireStrongKey
    data: 1
    type: dword

- name: "2.3.7.1 | PATCH | Ensure Interactive logon Do not require CTRL+ALT+DEL is set to Disabled"
  when: win19cis_rule_2_3_7_1
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.7.1
    - patch
    - logon
    - NIST800-171_3.1.8
    - NIST800-171_3.1.18
    - NIST800-53_AC-7
    - NIST800-53_AC-19
    - NIST800-53R5_AC-7
    - NIST800-53R5_AC-19
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows\Currentversion\Policies\System
    name: DisableCAD
    data: 0
    type: dword

- name: "2.3.7.2 | PATCH | Ensure Interactive logon Do not display last signed-in is set to Enabled"
  when: win19cis_rule_2_3_7_2
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.7.2
    - patch
    - logon
    - NIST800-171_3.1.8
    - NIST800-171_3.1.18
    - NIST800-53_AC-7
    - NIST800-53_AC-19
    - NIST800-53R5_AC-7
    - NIST800-53R5_AC-19
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows\Currentversion\Policies\System
    name: DontDisplayLastUserName
    data: 1
    type: dword

- name: "2.3.7.3 | PATCH | Ensure Interactive logon Machine inactivity limit is set to 900 or fewer seconds but not 0"
  when: win19cis_rule_2_3_7_3
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.7.3
    - patch
    - logon
    - NIST800-171_3.1.1
    - NIST800-171_3.1.10
    - NIST800-171_3.1.11
    - NIST800-53_AC-2_5
    - NIST800-53_AC-11
    - NIST800-53_AC-11_1
    - NIST800-53_AC-12
    - NIST800-53R5_AC-2_5
    - NIST800-53R5_AC-11
    - NIST800-53R5_AC-11_1
    - NIST800-53R5_AC-12
  block:
    - name: "2.3.7.3 | PATCH | Ensure Interactive logon Machine inactivity limit is set to 900 or fewer seconds but not 0. | Apply Settings To Registry."
      when:
        - win19cis_inactivity_timeout_seconds <= 900
        - win19cis_inactivity_timeout_seconds > 0
      ansible.windows.win_regedit:
        path: HKLM:\SOFTWARE\Microsoft\Windows\Currentversion\Policies\System
        name: InactivityTimeoutSecs
        data: "{{ win19cis_inactivity_timeout_seconds }}"
        type: dword

    - name: "2.3.7.3 | AUDIT | Ensure Interactive logon Machine inactivity limit is set to 900 or fewer seconds but not 0. | Warning Check For Variable Standards."
      when:
        - win19cis_inactivity_timeout_seconds > 900 or
          win19cis_inactivity_timeout_seconds == 0
      ansible.builtin.debug:
        msg:
          - "Warning!! You have an invalid number of seconds set for win19cis_inactivity_timeout_seconds please read"
          - "the notes for the variable and make the necessary change to the variable to be in compliance."

    - name: "2.3.7.3 | AUDIT | Ensure Interactive logon Machine inactivity limit is set to 900 or fewer seconds but not 0. | Warn Count."
      vars:
        warn_control_id: '2.3.7.3'
      when:
        - win19cis_inactivity_timeout_seconds > 900 or
          win19cis_inactivity_timeout_seconds == 0
      ansible.builtin.import_tasks:
        file: warning_facts.yml

- name: "2.3.7.4 | PATCH | Configure Interactive logon Message text for users attempting to log on"
  when: win19cis_rule_2_3_7_4
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.7.4
    - patch
    - logon
    - NIST800-171_3.1.9
    - NIST800-53_AC-8
    - NIST800-53R5_AC-8
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows\Currentversion\Policies\System
    name: LegalNoticeText
    data: "{{ win19cis_legal_notice }}"
    type: string

- name: "2.3.7.5 | PATCH | Configure Interactive logon Message title for users attempting to log on"
  when: win19cis_rule_2_3_7_5
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.7.5
    - patch
    - logon
    - NIST800-171_3.1.9
    - NIST800-53_AC-8
    - NIST800-53R5_AC-8
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows\Currentversion\Policies\System
    name: LegalNoticeCaption
    data: "{{ win19cis_legal_notice_caption }}"
    type: string

- name: "2.3.7.6 | PATCH | Ensure Interactive logon Number of previous logons to cache in case domain controller is not available is set to 4 or fewer logons MS only | Member Server"
  when:
    - win19cis_rule_2_3_7_6
    - prelim_win19cis_is_domain_member
  tags:
    - level2-memberserver
    - rule_2.3.7.6
    - patch
    - logon
    - NIST800-171_3.5.2
    - NIST800-53_IA-5_13
    - NIST800-53R5_IA-5_13
  block:
    - name: "2.3.7.6 | PATCH | Ensure Interactive logon Number of previous logons to cache in case domain controller is not available is set to 4 or fewer logons MS only. | Apply Settings To Registry | Member Server"
      when: win19cis_cached_logons_count <= 4
      ansible.windows.win_regedit:
        path: HKLM:\SOFTWARE\Microsoft\Windows Nt\Currentversion\Winlogon
        name: CachedLogonsCount
        data: "{{ win19cis_cached_logons_count }}"
        type: string

    - name: "2.3.7.6 | AUDIT | Ensure Interactive logon Number of previous logons to cache in case domain controller is not available is set to 4 or fewer logons MS only | Warning Check For Variable Standards | Member Server"
      when: win19cis_cached_logons_count > 4
      ansible.builtin.debug:
        msg:
          - "Warning!! You have an invalid number of logons set for win19cis_cached_logons_count please read"
          - "the notes for the variable and make the necessary change to the variable to be in compliance."

    - name: "2.3.7.6 | AUDIT | Ensure Interactive logon Number of previous logons to cache in case domain controller is not available is set to 4 or fewer logons MS only | Warn Count | Member Server"
      vars:
        warn_control_id: '2.3.7.6'
      when: win19cis_cached_logons_count > 4
      ansible.builtin.import_tasks:
        file: warning_facts.yml

- name: "2.3.7.7 | PATCH | Ensure Interactive logon Prompt user to change password before expiration is set to between 5 and 14 days"
  when: win19cis_rule_2_3_7_7
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.7.7
    - patch
    - logon
    - NIST800-171_3.5.2
    - NIST800-53_IA-5_1
    - NIST800-53R5_IA-5_1
  block:
    - name: "2.3.7.7 | PATCH | Ensure Interactive logon Prompt user to change password before expiration is set to between 5 and 14 days. | Apply Settings To Registry."
      when:
        - win19cis_password_expiry_warning_days >= 5
        - win19cis_password_expiry_warning_days <= 14
      ansible.windows.win_regedit:
        path: HKLM:\SOFTWARE\Microsoft\Windows Nt\Currentversion\Winlogon
        name: PasswordExpiryWarning
        data: "{{ win19cis_password_expiry_warning_days }}"
        type: dword

    - name: "2.3.7.7 | AUDIT | Ensure Interactive logon Prompt user to change password before expiration is set to between 5 and 14 days. | Warning Check For Variable Standards."
      when:
        - win19cis_password_expiry_warning_days < 5 or
          win19cis_password_expiry_warning_days > 14
      ansible.builtin.debug:
        msg:
          - "Warning!! You have an invalid number of days set for win19cis_password_expiry_warning_days please read"
          - "the notes for the variable and make the necessary change to the variable to be in compliance."

    - name: "2.3.7.7 | AUDIT | Ensure Interactive logon Prompt user to change password before expiration is set to between 5 and 14 days. | Warn Count."
      vars:
        warn_control_id: '2.3.7.7'
      when:
        - win19cis_password_expiry_warning_days < 5 or
          win19cis_password_expiry_warning_days > 14
      ansible.builtin.import_tasks:
        file: warning_facts.yml

- name: "2.3.7.8 | PATCH | Ensure Interactive logon Require Domain Controller Authentication to unlock workstation is set to Enabled MS only | Member Server"
  when:
    - win19cis_rule_2_3_7_8
    - prelim_win19cis_is_domain_member
  tags:
    - level1-memberserver
    - rule_2.3.7.8
    - patch
    - logon
    - NIST800-171_3.1.1
    - NIST800-171_3.1.10
    - NIST800-171_3.1.11
    - NIST800-53_AC-2_5
    - NIST800-53_AC-11
    - NIST800-53_AC-11_1
    - NIST800-53_AC-12
    - NIST800-53R5_AC-2_5
    - NIST800-53R5_AC-11
    - NIST800-53R5_AC-11_1
    - NIST800-53R5_AC-12
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows Nt\Currentversion\Winlogon
    name: ForceUnlockLogon
    data: 1
    type: dword

- name: "2.3.7.9 | PATCH | Ensure Interactive logon Smart card removal behavior is set to Lock Workstation or higher."
  when: win19cis_rule_2_3_7_9
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.7.9
    - patch
    - logon
    - NIST800-171_3.1.1
    - NIST800-171_3.1.10
    - NIST800-171_3.1.11
    - NIST800-53_AC-2_5
    - NIST800-53_AC-11
    - NIST800-53_AC-11_1
    - NIST800-53_AC-12
    - NIST800-53R5_AC-2_5
    - NIST800-53R5_AC-11
    - NIST800-53R5_AC-11_1
    - NIST800-53R5_AC-12
  block:
    - name: "2.3.7.9 | PATCH | Ensure Interactive logon Smart card removal behavior is set to Lock Workstation or higher | Apply Settings To Registry."
      when:
        - win19cis_sc_remove_option >= 1
        - win19cis_sc_remove_option <= 3
      ansible.windows.win_regedit:
        path: HKLM:\SOFTWARE\Microsoft\Windows Nt\Currentversion\Winlogon
        name: ScRemoveOption
        data: "{{ win19cis_sc_remove_option }}"
        type: string

    - name: "2.3.7.9 | AUDIT | Ensure Interactive logon Smart card removal behavior is set to Lock Workstation or higher | Warning Check For Variable Standards."
      when:
        - win19cis_sc_remove_option == 0 or
          win19cis_sc_remove_option > 3
      ansible.builtin.debug:
        msg:
          - "Warning!! You have an invalid setting for win19cis_sc_remove_option. Please read"
          - "the notes for the variable and make the necessary change to the variable to be in compliance."

    - name: "2.3.7.9 | AUDIT | Ensure Interactive logon Smart card removal behavior is set to Lock Workstation or higher | Warn Count."
      vars:
        warn_control_id: '2.3.7.9'
      when:
        - win19cis_sc_remove_option == 0 or
          win19cis_sc_remove_option > 3
      ansible.builtin.import_tasks:
        file: warning_facts.yml

- name: "2.3.8.1 | PATCH | Ensure Microsoft network client Digitally sign communications always is set to Enabled"
  when: win19cis_rule_2_3_8_1
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.8.1
    - patch
    - logon
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_IA-5
    - NIST800-53_IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_IA-5
    - NIST800-53R5_IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Services\Lanmanworkstation\Parameters
    name: RequireSecuritySignature
    data: 1
    type: dword

- name: "2.3.8.2 | PATCH | Ensure Microsoft network client Digitally sign communications if server agrees is set to Enabled"
  when: win19cis_rule_2_3_8_2
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.8.2
    - patch
    - logon
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_IA-5
    - NIST800-53_IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_IA-5
    - NIST800-53R5_IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Services\Lanmanworkstation\Parameters
    name: EnableSecuritySignature
    data: 1
    type: dword

- name: "2.3.8.3 | PATCH | Ensure Microsoft network client Send unencrypted password to third-party SMB servers is set to Disabled"
  when: win19cis_rule_2_3_8_3
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.8.3
    - patch
    - encryption
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_IA-5
    - NIST800-53_IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_IA-5
    - NIST800-53R5_IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Services\Lanmanworkstation\Parameters
    name: EnablePlainTextPassword
    data: 0
    type: dword

- name: "2.3.9.1 | PATCH | Ensure Microsoft network server Amount of idle time required before suspending session is set to 15 or fewer minutes."
  when: win19cis_rule_2_3_9_1
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.9.1
    - patch
    - account
    - NIST800-171_3.1.11
    - NIST800-53_AC-12
    - NIST800-53R5_AC-12
  block:
    - name: "2.3.9.1 | PATCH | Ensure Microsoft network server Amount of idle time required before suspending session is set to 15 or fewer minutes. | Apply Settings To Registry."
      when: win19cis_smb_auto_disconnect_time <= 15
      ansible.windows.win_regedit:
        path: HKLM:\SYSTEM\Currentcontrolset\Services\Lanmanserver\Parameters
        name: AutoDisconnect
        data: "{{ win19cis_smb_auto_disconnect_time }}"
        type: dword

    - name: "2.3.9.1 | AUDIT | Ensure Microsoft network server Amount of idle time required before suspending session is set to 15 or fewer minutes. | Warning Check For Variable Standards."
      when: win19cis_smb_auto_disconnect_time > 15
      ansible.builtin.debug:
        msg:
          - "Warning!! You have an invalid number of minutes set for win19cis_smb_auto_disconnect_time please read"
          - "the notes for the variable and make the necessary change to the variable to be in compliance."

    - name: "2.3.9.1 | AUDIT | Ensure Microsoft network server Amount of idle time required before suspending session is set to 15 or fewer minutes. | Warn Count."
      vars:
        warn_control_id: '2.3.9.1'
      when: win19cis_smb_auto_disconnect_time > 15
      ansible.builtin.import_tasks:
        file: warning_facts.yml

- name: "2.3.9.2 | PATCH | Ensure Microsoft network server Digitally sign communications always is set to Enabled"
  when: win19cis_rule_2_3_9_2
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.9.2
    - patch
    - account
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_IA-5
    - NIST800-53_IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_IA-5
    - NIST800-53R5_IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Services\Lanmanserver\Parameters
    name: RequireSecuritySignature
    data: 1
    type: dword

- name: "2.3.9.3 | PATCH | Ensure Microsoft network server Digitally sign communications if client agrees is set to Enabled"
  when: win19cis_rule_2_3_9_3
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.9.3
    - patch
    - account
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_IA-5
    - NIST800-53_IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_IA-5
    - NIST800-53R5_IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Services\Lanmanserver\Parameters
    name: EnableSecuritySignature
    data: 1
    type: dword

- name: "2.3.9.4 | PATCH | Ensure Microsoft network server Disconnect clients when logon hours expire is set to Enabled"
  when: win19cis_rule_2_3_9_4
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.9.4
    - patch
    - account
    - NIST800-171_3.1.2
    - NIST800-53_AC-2_12
    - NIST800-53R5_AC-2_12
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Services\Lanmanserver\Parameters
    name: EnableForcedLogoff
    data: 1
    type: dword

- name: "2.3.9.5 | PATCH | Ensure Microsoft network server Server SPN target name validation level is set to Accept if provided by client or higher. | MS Only"
  when:
    - win19cis_rule_2_3_9_5
    - prelim_win19cis_is_domain_member
    - not prelim_win19cis_is_standalone
  tags:
    - level1-memberserver
    - rule_2.3.9.5
    - patch
    - account
    - NIST800-171_3.4.1
    - NIST800-171_3.4.2
    - NIST800-171_3.4.6
    - NIST800-171_3.4.7
    - NIST800-171_3.13.1
    - NIST800-171_3.13.2
    - NIST800-53_CM-1
    - NIST800-53_CM-2
    - NIST800-53_AC-2
    - NIST800-53_CM-6
    - NIST800-53_CM-7
    - NIST800-53_CM-7_1
    - NIST800-53_CM-9
    - NIST800-53_SA-3
    - NIST800-53_SA-8
    - NIST800-53_SA-10
    - NIST800-53R5_CM-1
    - NIST800-53R5_CM-2
    - NIST800-53R5_AC-2
    - NIST800-53R5_CM-6
    - NIST800-53R5_CM-7
    - NIST800-53R5_CM-7_1
    - NIST800-53R5_CM-9
    - NIST800-53R5_SA-3
    - NIST800-53R5_SA-8
    - NIST800-53R5_SA-10
  block:
    - name: "2.3.9.5 | PATCH | Ensure Microsoft network server Server SPN target name validation level is set to Accept if provided by client or higher. | Apply Registry Setting | MS Only."
      when:
        - win19cis_smb_server_name_hardening_level == 1 or
          win19cis_smb_server_name_hardening_level == 2
      ansible.windows.win_regedit:
        path: HKLM:\SYSTEM\Currentcontrolset\Services\LanManServer\Parameters
        name: SMBServerNameHardeningLevel
        data: "{{ win19cis_smb_server_name_hardening_level }}"
        type: dword

    - name: "2.3.9.5 | AUDIT | Ensure Microsoft network server Server SPN target name validation level is set to Accept if provided by client or higher. | Warning Check For Variable Standards. | MS Only"
      when:
        - win19cis_smb_server_name_hardening_level == 0 or
          win19cis_smb_server_name_hardening_level > 2
      ansible.builtin.debug:
        msg:
          - "Warning!! You have an invalid number variable set for win19cis_smb_server_name_hardening_level. Please read"
          - "the notes for the variable and make the necessary change to the variable to be in compliance."

    - name: "2.3.9.5 | AUDIT | Ensure Microsoft network server Server SPN target name validation level is set to Accept if provided by client or higher. | Warn Count."
      vars:
        warn_control_id: '2.3.9.5'
      when:
        - win19cis_smb_server_name_hardening_level == 0 or
          win19cis_smb_server_name_hardening_level > 2
      ansible.builtin.import_tasks:
        file: warning_facts.yml

- name: "2.3.10.1 | PATCH | Ensure Network access Allow anonymous SID/Name translation is set to Disabled"
  when: win19cis_rule_2_3_10_1
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.10.1
    - patch
    - securitypolicy
    - NIST800-171_3.1.7
    - NIST800-171_3.5.3
    - NIST800-53_AC-6_10
    - NIST800-53_IA-2_2
    - NIST800-53R5_AC-6_10
    - NIST800-53R5_IA-2_2
  community.windows.win_security_policy:
    section: System Access
    key: LSAAnonymousNameLookup
    value: 0

- name: "2.3.10.2 | PATCH | Ensure Network access Do not allow anonymous enumeration of SAM accounts is set to Enabled MS only | Member Server"
  when:
    - win19cis_rule_2_3_10_2
    - prelim_win19cis_is_domain_member
  tags:
    - level1-memberserver
    - rule_2.3.10.2
    - patch
    - sam
    - NIST800-171_3.1.7
    - NIST800-53_AC-6_10
    - NIST800-53R5_AC-6_10
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Lsa
    name: RestrictAnonymousSAM
    data: 1
    type: dword

- name: "2.3.10.3 | PATCH | Ensure Network access Do not allow anonymous enumeration of SAM accounts and shares is set to Enabled MS only | Member Server"
  when:
    - win19cis_rule_2_3_10_3
    - prelim_win19cis_is_domain_member
  tags:
    - level1-memberserver
    - rule_2.3.10.3
    - patch
    - sam
    - NIST800-171_3.1.7
    - NIST800-53_AC-6_10
    - NIST800-53R5_AC-6_10
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Lsa
    name: RestrictAnonymous
    data: 1
    type: dword

- name: "2.3.10.4 | PATCH | Ensure Network access Do not allow storage of passwords and credentials for network authentication is set to Enabled"
  when: win19cis_rule_2_3_10_4
  tags:
    - level2-domaincontroller
    - level2-memberserver
    - rule_2.3.10.4
    - patch
    - accounts
    - NIST800-171_3.5.10
    - NIST800-53_IA-5_1_c
    - NIST800-53R5_IA-5_1_c
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Lsa
    name: DisableDomainCreds
    data: 1
    type: dword

- name: "2.3.10.5 | PATCH | Ensure Network access Let Everyone permissions apply to anonymous users is set to Disabled"
  when: win19cis_rule_2_3_10_5
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.10.5
    - patch
    - accounts
    - NIST800-171_3.1.7
    - NIST800-53_AC-6_10
    - NIST800-53R5_AC-6_10
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Lsa
    name: EveryoneIncludesAnonymous
    data: 0
    type: dword

- name: "2.3.10.6 | PATCH | Configure Network access Named Pipes that can be accessed anonymously DC only | Domain Controller"
  when:
    - win19cis_rule_2_3_10_6
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.3.10.6
    - patch
    - namedpipes
    - NIST800-171_3.5.3
    - NIST800-53_IA-2_2
    - NIST800-53R5_IA-2_2
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Services\LanManServer\Parameters
    name: NullSessionPipes
    data: ['LSARPC', 'NETLOGON', 'SAMR']
    type: multistring

- name: "2.3.10.7 | PATCH | Configure Network access Named Pipes that can be accessed anonymously MS only | Member Server"
  when:
    - win19cis_rule_2_3_10_7
    - prelim_win19cis_is_domain_member
  tags:
    - level1-memberserver
    - rule_2.3.10.7
    - patch
    - namedpipes
    - NIST800-171_3.5.3
    - NIST800-53_IA-2_2
    - NIST800-53R5_IA-2_2
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Services\LanManServer\Parameters
    name: NullSessionPipes
    data: ""
    type: multistring

- name: "2.3.10.8 | PATCH | Configure Network access Remotely accessible registry paths"
  when: win19cis_rule_2_3_10_8
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.10.8
    - patch
    - NIST800-171_3.1.5
    - NIST800-53_AC-6_7_b
    - NIST800-53R5_AC-6_7_b
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Securepipeservers\Winreg\AllowedExactpaths
    name: "Machine"
    data: [
      'SYSTEM\CurrentControlSet\Control\ProductOptions',
      'SYSTEM\CurrentControlSet\Control\Server Applications',
      'SOFTWARE\Microsoft\Windows NT\CurrentVersion'
    ]
    type: multistring

- name: "2.3.10.9 | PATCH | Configure Network access Remotely accessible registry paths and sub-paths"
  when: win19cis_rule_2_3_10_9
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3_10_9
    - patch
    - NIST800-171_3.1.5
    - NIST800-53_AC-6_7_b
    - NIST800-53R5_AC-6_7_b
  block:
    - name: "2.3.10.9 | PATCH | Configure Network access Remotely accessible registry paths and sub-paths | Set Fact"
      ansible.builtin.set_fact:
        rule_2_3_10_9_remote_registry_paths: [
          'SYSTEM\CurrentControlSet\Control\Print\Printers',
          'SYSTEM\CurrentControlSet\Services\Eventlog',
          'SOFTWARE\Microsoft\OLAP Server',
          'SOFTWARE\Microsoft\Windows NT\CurrentVersion\Print',
          'SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows',
          'SYSTEM\CurrentControlSet\Control\ContentIndex',
          'SYSTEM\CurrentControlSet\Control\Terminal Server',
          'SYSTEM\CurrentControlSet\Control\Terminal Server\UserConfig',
          'SYSTEM\CurrentControlSet\Control\Terminal Server\DefaultUserConfiguration',
          'SOFTWARE\Microsoft\Windows NT\CurrentVersion\Perflib',
          'SYSTEM\CurrentControlSet\Services\SysmonLog'
        ]

    - name: "2.3.10.9 | AUDIT | Configure Network access Remotely accessible registry paths and sub-paths | Check if AD Certificate Services feature is installed."
      community.windows.win_feature_info:
        name: AD-Certificate
      register: rule_2_3_10_9_adcs_feature

    - name: "2.3.10.9 | AUDIT | Configure Network access Remotely accessible registry paths and sub-paths | Add CertSvc to paths."
      when: rule_2_3_10_9_adcs_feature.features[0].installed
      ansible.builtin.set_fact:
        rule_2_3_10_9_remote_registry_paths: "{{ rule_2_3_10_9_remote_registry_paths + ['SYSTEM\\CurrentControlSet\\Services\\CertSvc'] }}"

    - name: "2.3.10.9 | AUDIT | Check if WINS feature is installed."
      community.windows.win_feature_info:
        name: WINS
      register: rule_2_3_10_9_wins_feature

    - name: "2.3.10.9 | AUDIT | Configure Network access Remotely accessible registry paths and sub-paths | Add WINS to paths."
      when: rule_2_3_10_9_wins_feature.features[0].installed
      ansible.builtin.set_fact:
        rule_2_3_10_9_remote_registry_paths: "{{ rule_2_3_10_9_remote_registry_paths + ['SYSTEM\\CurrentControlSet\\Services\\WINS'] }}"

    - name: "2.3.10.9 | PATCH | Configure Network access Remotely accessible registry paths and sub-paths | Apply Settings"
      ansible.windows.win_regedit:
        path: HKLM:\SYSTEM\Currentcontrolset\Control\Securepipeservers\Winreg\Allowedpaths
        name: "Machine"
        data: "{{ rule_2_3_10_9_remote_registry_paths }}"
        type: multistring

- name: "2.3.10.10 | PATCH | Configure Network access Remotely accessible registry paths and sub-paths | Ensure Network access Restrict anonymous access to Named Pipes and Shares is set to Enabled"
  when: win19cis_rule_2_3_10_10
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.10.10
    - patch
    - namedpipes
    - NIST800-171_3.1.7
    - NIST800-53_AC-6_10
    - NIST800-53R5_AC-6_10
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Services\Lanmanserver\Parameters
    name: RestrictNullSessAccess
    data: 1
    type: dword

- name: "2.3.10.11 | PATCH | Ensure Network access Restrict clients allowed to make remote calls to SAM is set to Administrators Remote Access Allow MS only | Member Server"
  when:
    - win19cis_rule_2_3_10_11
    - prelim_win19cis_is_domain_member
  tags:
    - level1-memberserver
    - rule_2.3.10.11
    - patch
    - sam
    - NIST800-171_3.1.5
    - NIST800-53_AC-6_3
    - NIST800-53R5_AC-6_3
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
    name: RestrictRemoteSAM
    data: "O:BAG:BAD:(A;;RC;;;BA)"
    type: string

- name: "2.3.10.12 | PATCH | Ensure Network access Shares that can be accessed anonymously is set to None"
  when: win19cis_rule_2_3_10_12
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.10.12
    - patch
    - shares
    - NIST800-171_3.1.1
    - NIST800-53_AC-3
    - NIST800-53R5_AC-3
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Services\Lanmanserver\Parameters
    name: NullSessionShares
    data: ""
    type: multistring

- name: "2.3.10.13 | PATCH | Ensure Network access Sharing and security model for local accounts is set to Classic - local users authenticate as themselves"
  when: win19cis_rule_2_3_10_13
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.10.13
    - patch
    - guest
    - NIST800-171_3.4.2
    - NIST800-53_CM-6b.
    - NIST800-53R5_CM-6b.
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Lsa
    name: ForceGuest
    data: 0
    type: dword

- name: "2.3.11.1 | PATCH | Ensure Network security Allow Local System to use computer identity for NTLM is set to Enabled"
  when: win19cis_rule_2_3_11_1
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.11.1
    - patch
    - ntlm
    - NIST800-53_IA-3
    - NIST800-53R5_IA-3
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Lsa
    name: UseMachineId
    data: 1
    type: dword

- name: "2.3.11.2 | PATCH | Ensure Network security Allow LocalSystem NULL session fallback is set to Disabled"
  when: win19cis_rule_2_3_11_2
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.11.2
    - patch
    - localsystem
    - NIST800-171_3.1.7
    - NIST800-53_AC-6_10
    - NIST800-53R5_AC-6_10
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Lsa\Msv1_0
    name: AllowNullSessionFallback
    data: 0
    type: dword

- name: "2.3.11.3 | PATCH | Ensure Network Security Allow PKU2U authentication requests to this computer to use online identities is set to Disabled"
  when: win19cis_rule_2_3_11_3
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.11.3
    - patch
    - authentication
    - NIST800-171_3.4.1
    - NIST800-171_3.4.2
    - NIST800-171_3.4.6
    - NIST800-171_3.4.7
    - NIST800-171_3.13.1
    - NIST800-171_3.13.2
    - NIST800-53_CM-1
    - NIST800-53_CM-2
    - NIST800-53_AC-2
    - NIST800-53_CM-6
    - NIST800-53_CM-7
    - NIST800-53_CM-7_1
    - NIST800-53_CM-9
    - NIST800-53_SA-3
    - NIST800-53_SA-8
    - NIST800-53_SA-10
    - NIST800-53R5_CM-1
    - NIST800-53R5_CM-2
    - NIST800-53R5_AC-2
    - NIST800-53R5_CM-6
    - NIST800-53R5_CM-7
    - NIST800-53R5_CM-7_1
    - NIST800-53R5_CM-9
    - NIST800-53R5_SA-3
    - NIST800-53R5_SA-8
    - NIST800-53R5_SA-10
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Lsa\Pku2U
    name: AllowOnlineID
    data: 0
    type: dword

- name: "2.3.11.4 | PATCH | Ensure Network security Configure encryption types allowed for Kerberos is set to AES128 HMAC SHA1 AES256 HMAC SHA1 Future encryption types"
  when: win19cis_rule_2_3_11_4
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.11.4
    - patch
    - encryption
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_IA-5
    - NIST800-53_IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_IA-5
    - NIST800-53R5_IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  block:
    - name: "2.3.11.4 | PATCH | Ensure Network security Configure encryption types allowed for Kerberos is set to AES128 HMAC SHA1 AES256 HMAC SHA1 Future encryption types | Legacy App Encryption Support"
      when: win19cis_legacy_rc4_hmac_md5_support
      ansible.windows.win_regedit:
        path: HKLM:\Software\Microsoft\Windows\Currentversion\Policies\System\Kerberos\Parameters
        name: SupportedEncryptionTypes
        data: 2147483644
        type: dword

    - name: "2.3.11.4 | PATCH | Ensure Network security Configure encryption types allowed for Kerberos is set to AES128 HMAC SHA1 AES256 HMAC SHA1 Future encryption types | No Legacy App Encryption Support"
      when: not win19cis_legacy_rc4_hmac_md5_support
      ansible.windows.win_regedit:
        path: HKLM:\Software\Microsoft\Windows\Currentversion\Policies\System\Kerberos\Parameters
        name: SupportedEncryptionTypes
        data: 2147483640
        type: dword

- name: "2.3.11.5 | PATCH | Ensure Network security Do not store LAN Manager hash value on next password change is set to Enabled"
  when: win19cis_rule_2_3_11_5
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.11.5
    - patch
    - network
    - NIST800-171_3.5.2
    - NIST800-171_3.13.16
    - NIST800-53_IA-5_1
    - NIST800-53_SC-28
    - NIST800-53_SC-28_1
    - NIST800-53R5_IA-5_1
    - NIST800-53R5_SC-28
    - NIST800-53R5_SC-28_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Lsa
    name: NoLMHash
    data: 1
    type: dword

- name: "2.3.11.6 | PATCH | Ensure Network security Force logoff when logon hours expire is set to Enabled"
  when: win19cis_rule_2_3_11_6
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2_3_11_6
    - patch
    - network
    - NIST800-171_3.1.2
    - NIST800-53_AC-2_12
    - NIST800-53R5_AC-2_12
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters
    name: EnableForcedLogOff
    data: 1
    type: dword

- name: "2.3.11.7 | PATCH | Ensure Network security LAN Manager authentication level is set to Send NTLMv2 response only. Refuse LM NTLM"
  when: win19cis_rule_2_3_11_7
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.11.7
    - patch
    - network
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_AC-IA-5
    - NIST800-53_AC-IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_AC-IA-5
    - NIST800-53R5_AC-IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Lsa
    name: LMCompatibilityLevel
    data: 5
    type: dword

- name: "2.3.11.8 | PATCH | Ensure Network security LDAP client signing requirements is set to Negotiate signing or higher."
  when: win19cis_rule_2_3_11_8
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.11.8
    - patch
    - ldap
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_AC-IA-5
    - NIST800-53_AC-IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_AC-IA-5
    - NIST800-53R5_AC-IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  block:
    - name: "2.3.11.8 | PATCH | Ensure Network security LDAP client signing requirements is set to Negotiate signing or higher. | Apply Variable To Registry."
      when:
        - win19cis_ldap_client_integrity == 1 or
          win19cis_ldap_client_integrity == 2
      ansible.windows.win_regedit:
        path: HKLM:\SYSTEM\Currentcontrolset\Services\Ldap
        name: LDAPClientIntegrity
        data: "{{ win19cis_ldap_client_integrity }}"
        type: dword

    - name: "2.3.11.8 | AUDIT | Ensure Network security LDAP client signing requirements is set to Negotiate signing or higher. | Warning Check For Variable."
      when:
        - win19cis_ldap_client_integrity == 0 or
          win19cis_ldap_client_integrity > 2
      ansible.builtin.debug:
        msg:
          - "Warning!! You have an invalid variable set for win19cis_ldap_client_integrity. Please read"
          - "the notes for the variable and make the necessary change to the variable to be in compliance."

    - name: "2.3.11.8 | AUDIT | Ensure Network security LDAP client signing requirements is set to Negotiate signing or higher. | Warn Count."
      vars:
        warn_control_id: '2.3.11.8'
      when:
        - win19cis_ldap_client_integrity == 0 or
          win19cis_ldap_client_integrity > 2
      ansible.builtin.import_tasks:
        file: warning_facts.yml

- name: "2.3.11.9 | PATCH | Ensure Network security Minimum session security for NTLM SSP based including secure RPC clients is set to Require NTLMv2 session security Require 128-bit encryption"
  when: win19cis_rule_2_3_11_9
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.11.9
    - patch
    - ntlm
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_AC-IA-5
    - NIST800-53_AC-IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_AC-IA-5
    - NIST800-53R5_AC-IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Lsa\Msv1_0
    name: NTLMMinClientSec
    data: 537395200
    type: dword

- name: "2.3.11.10 | PATCH | Ensure Network security Minimum session security for NTLM SSP based including secure RPC servers is set to Require NTLMv2 session security Require 128-bit encryption"
  when: win19cis_rule_2_3_11_10
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.11.10
    - patch
    - ntlm
    - NIST800-171_3.1.13
    - NIST800-171_3.5.2
    - NIST800-171_3.13.8
    - NIST800-53_AC-17_2
    - NIST800-53_AC-IA-5
    - NIST800-53_AC-IA-5_1
    - NIST800-53_SC-8
    - NIST800-53_SC-8_1
    - NIST800-53R5_AC-17_2
    - NIST800-53R5_AC-IA-5
    - NIST800-53R5_AC-IA-5_1
    - NIST800-53R5_SC-8
    - NIST800-53R5_SC-8_1
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Lsa\Msv1_0
    name: NTLMMinServerSec
    data: 537395200
    type: dword

- name: "2.3.11.11 | PATCH | Ensure Network security: Restrict NTLM: Audit Incoming NTLM Traffic is set to Enable auditing for all accounts"
  when: win19cis_rule_2_3_11_11
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.11.11
    - patch
    - ntlm
    - NIST800-171_3.3.1
    - NIST800-171_3.3.2
    - NIST800-171_3.3.6
    - NIST800-53_AU-3
    - NIST800-53_AU-3_1
    - NIST800-53_AU-7
    - NIST800-53_AU-12
    - NIST800-53R5_AU-3
    - NIST800-53R5_AU-3_1
    - NIST800-53R5_AU-7
    - NIST800-53R5_AU-12
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Lsa\MSV1_0
    name: AuditReceivingNTLMTraffic
    data: 2
    type: dword

- name: "2.3.11.12 | PATCH | Ensure Network security: Restrict NTLM: Audit NTLM authentication in this domain is set to Enable all DC Only"
  when:
    - win19cis_rule_2_3_11_12
    - prelim_win19cis_is_domain_controller
  tags:
    - level1-domaincontroller
    - rule_2.3.11.12
    - patch
    - ntlm
    - NIST800-171_3.3.1
    - NIST800-171_3.3.2
    - NIST800-171_3.3.6
    - NIST800-53_AU-3
    - NIST800-53_AU-3_1
    - NIST800-53_AU-7
    - NIST800-53_AU-12
    - NIST800-53R5_AU-3
    - NIST800-53R5_AU-3_1
    - NIST800-53R5_AU-7
    - NIST800-53R5_AU-12
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters
    name: AuditNTLMInDomain
    data: 7
    type: dword

- name: "2.3.11.13 | PATCH | Ensure Network security: Restrict NTLM: Outgoing NTLM traffic to remote servers is set to Audit all or higher"
  when: win19cis_rule_2_3_11_13
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.11.13
    - patch
    - ntlm
    - NIST800-171_3.3.1
    - NIST800-171_3.3.2
    - NIST800-171_3.3.6
    - NIST800-53_AU-3
    - NIST800-53_AU-3_1
    - NIST800-53_AU-7
    - NIST800-53_AU-12
    - NIST800-53R5_AU-3
    - NIST800-53R5_AU-3_1
    - NIST800-53R5_AU-7
    - NIST800-53R5_AU-12
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Lsa\MSV1_0
    name: RestrictSendingNTLMTraffic
    data: 2
    type: dword

- name: "2.3.13.1 | PATCH | Ensure Shutdown Allow system to be shut down without having to log on is set to Disabled"
  when: win19cis_rule_2_3_13_1
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.13.1
    - patch
    - system
    - shutdown
    - NIST800-171_3.1.7
    - NIST800-53_AC-6_10
    - NIST800-53R5_AC-6_10
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows\Currentversion\Policies\System
    name: ShutdownWithoutLogon
    data: 0
    type: dword

- name: "2.3.15.1 | PATCH | Ensure System objects Require case insensitivity for non-Windows subsystems is set to Enabled"
  when: win19cis_rule_2_3_15_1
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.15.1
    - patch
    - NIST800-171_3.4.2
    - NIST800-53_CM-6b.
    - NIST800-53R5_CM-6b.
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Session Manager\Kernel
    name: ObCaseInsensitive
    data: 1
    type: dword

- name: "2.3.15.2 | PATCH | Ensure System objects Strengthen default permissions of internal system objects e.g. Symbolic Links is set to Enabled"
  when: win19cis_rule_2_3_15_2
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2.3.15.2
    - patch
    - NIST800-171_3.4.1
    - NIST800-171_3.4.2
    - NIST800-171_3.4.6
    - NIST800-171_3.4.7
    - NIST800-171_3.13.1
    - NIST800-171_3.13.2
    - NIST800-53_CM-1
    - NIST800-53_CM-2
    - NIST800-53_AC-2
    - NIST800-53_CM-6
    - NIST800-53_CM-7
    - NIST800-53_CM-7_1
    - NIST800-53_CM-9
    - NIST800-53_SA-3
    - NIST800-53_SA-8
    - NIST800-53_SA-10
    - NIST800-53R5_CM-1
    - NIST800-53R5_CM-2
    - NIST800-53R5_AC-2
    - NIST800-53R5_CM-6
    - NIST800-53R5_CM-7
    - NIST800-53R5_CM-7_1
    - NIST800-53R5_CM-9
    - NIST800-53R5_SA-3
    - NIST800-53R5_SA-8
    - NIST800-53R5_SA-10
  ansible.windows.win_regedit:
    path: HKLM:\SYSTEM\Currentcontrolset\Control\Session Manager
    name: ProtectionMode
    data: 1
    type: dword

- name: "2.3.17.1 | PATCH | Ensure User Account Control Admin Approval Mode for the Built-in Administrator account is set to Enabled"
  when: win19cis_rule_2_3_17_1
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2_3_17_1
    - patch
    - uac
    - NIST800-171_3.1.1
    - NIST800-53_AC-2_9
    - NIST800-53R5_AC-2_9
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows\Currentversion\Policies\System
    name: FilterAdministratorToken
    data: 1
    type: dword

- name: "2.3.17.2 | PATCH | Ensure User Account Control Behavior of the elevation prompt for administrators in Admin Approval Mode is set to Prompt for consent on the secure desktop"
  when: win19cis_rule_2_3_17_2
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2_3_17_2
    - patch
    - uac
    - NIST800-171_3.1.5
    - NIST800-53_AC-6_1
    - NIST800-53R5_AC-6_1
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows\Currentversion\Policies\System
    name: ConsentPromptBehaviorAdmin
    data: "{{ win19cis_consent_prompt_behavior_admin }}"
    type: dword

- name: "2.3.17.3 | PATCH | Ensure User Account Control Behavior of the elevation prompt for standard users is set to Automatically deny elevation requests"
  when: win19cis_rule_2_3_17_3
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2_3_17_3
    - patch
    - uac
    - NIST800-171_3.1.7
    - NIST800-53_AC-6_10
    - NIST800-53R5_AC-6_10
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows\Currentversion\Policies\System
    name: ConsentPromptBehaviorUser
    data: 0
    type: dword

- name: "2.3.17.4 | PATCH | Ensure User Account Control Detect application installations and prompt for elevation is set to Enabled"
  when: win19cis_rule_2_3_17_4
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2_3_17_4
    - patch
    - uac
    - NIST800-171_3.1.5
    - NIST800-53_AC-6_8
    - NIST800-53R5_AC-6_8
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows\Currentversion\Policies\System
    name: EnableInstallerDetection
    data: 1
    type: dword

- name: "2.3.17.5 | PATCH | Ensure User Account Control Only elevate UIAccess applications that are installed in secure locations is set to Enabled"
  when: win19cis_rule_2_3_17_5
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2_3_17_5
    - patch
    - uac
    - NIST800-171_3.1.5
    - NIST800-53_AC-6_8
    - NIST800-53R5_AC-6_8
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows\Currentversion\Policies\System
    name: EnableSecureUIAPaths
    data: 1
    type: dword

- name: "2.3.17.6 | PATCH | Ensure User Account Control Run all administrators in Admin Approval Mode is set to Enabled"
  when: win19cis_rule_2_3_17_6
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2_3_17_6
    - patch
    - uac
    - NIST800-171_3.1.5
    - NIST800-53_AC-6_1
    - NIST800-53R5_AC-6_1
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows\Currentversion\Policies\System
    name: EnableLUA
    data: 1
    type: dword

- name: "2.3.17.7 | PATCH | Ensure User Account Control Switch to the secure desktop when prompting for elevation is set to Enabled"
  when: win19cis_rule_2_3_17_7
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2_3_17_7
    - patch
    - uac
    - NIST800-171_3.1.5
    - NIST800-53_AC-6_1
    - NIST800-53R5_AC-6_1
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows\Currentversion\Policies\System
    name: PromptOnSecureDesktop
    data: 1
    type: dword

- name: "2.3.17.8 | PATCH | Ensure User Account Control Virtualize file and registry write failures to per-user locations is set to Enabled"
  when: win19cis_rule_2_3_17_8
  tags:
    - level1-domaincontroller
    - level1-memberserver
    - rule_2_3_17_8
    - patch
    - uac
    - NIST800-53_SC-29_1
    - NIST800-53R5_SC-29_1
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows\Currentversion\Policies\System
    name: EnableVirtualization
    data: 1
    type: dword
